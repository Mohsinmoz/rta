function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++)e=t[s].split("="),a.push(e[0]),a[e[0]]=e[1];return a}$(document).ready(function(){function e(){$("#searchResultsLoader").show(),$("#searchResultsNone").hide(),$me=$("#searchKW"),$next=$(".load-more-search").attr("data-next");var e=$me.val(),a=(permore,new Array);e.length>0?($count=0,$.ajax({url:"https://www.googleapis.com/customsearch/v1?key=AIzaSyCMGfdDaSfjqv5zYoS0mTJnOT3e9MURWkU&cx=016717179209839831092:_jnvsjx-bgs&q="+encodeURIComponent(e),type:"GET",async:"true",success:function(s){if($.ajax({url:"/wps/PA_IDOSProject/getServicesNamesServlet?lang=ar&methodName=getServicesNamesWithIDs",type:"GET",async:!0,success:function(a){var t=/\\/g;jsonData=JSON.parse(a);for(var s in jsonData){var t=new RegExp(e.trim(),"gi"),r=jsonData[s].value,i=jsonData[s].label,t=new RegExp(e.trim().toLowerCase(),"gi");i.toLowerCase().match(t)&&""!=r.trim()&&$("#search_part .search-autosuggest ul").prepend('<li><a href="https://www.rta.ae/wps/portal/rta/ae/home/idos?serviceId='+r.trim()+'">'+i.trim()+"</a></li>")}}}),null!=s.items)if(s.items.length>0){$("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;"),$.each(s.items,function(){if($item=$(this),$.each(suggestionKW2,function(t,s){var r=new RegExp(s.toLowerCase(),"gi");e.length<=2?$item[0].title.toLowerCase().match(r)&&$.inArray(s,a)<0&&a.push(s):($item[0].snippet.toLowerCase().match(r)||$item[0].title.toLowerCase().match(r))&&$.inArray(s,a)<0&&a.push(s)}),e.length<=2){var t=new RegExp(e.toLowerCase(),"gi");$item[0].title.toLowerCase().match(t)&&($("#search_part .search-autosuggest ul").append('<li><a href="'+$item[0].link+'">'+$item[0].title+"</a></li>"),$count++)}else $("#search_part .search-autosuggest ul").append('<li><a href="'+$item[0].link+'">'+$item[0].title+"</a></li>"),$count++});var r=getUrlVars().kw;if(("undefined"==typeof r||""==r)&&($("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$(".sugclose").show(),$("#search_part .search-autosuggest").show()),$(".suggestions").length>0){var l=Array();$(".suggestions").empty(),a.length>0?(i=0,$.each(a,function(e,a){10>e&&$.inArray(a.toLowerCase(),l)<0&&(l.push(a),e++)})):(i=0,$.each(s.items,function(){$item=$(this),i<10&&$.inArray($item[0].title.toLowerCase(),l)<0&&(l.push($item[0].title),i++)})),$.each(l,function(e,a){$(".suggestions").append($("<li>").append($("<a>").html(a).bind("click")))})}if($(".search-result").length>0){$(".search-result").empty();var c=[];$.ajax({url:"/wps/PA_IDOSProject/getServicesNamesServlet?lang=ar&methodName=getServicesNamesWithIDs",type:"GET",async:!0,success:function(a){var t=/\\/g;jsonData=JSON.parse(a);for(var r in jsonData){var t=new RegExp(e.trim(),"gi"),i=jsonData[r].value,l=jsonData[r].label;""!=l&&(l=l.replace(t,"<b>$&</b>"));var h=jsonData[r].description+"";""!=h&&(h=h.replace(t,"<b>$&</b>"));var t=new RegExp(e.trim().toLowerCase(),"gi");if(l.toLowerCase().match(t)&&""!=i.trim()){var n={};n.value=i,n.label=l,n.desription=h,c.push(n)}}for(var m="",g=0;g<c.length;g++)tags="",$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");(c[g].desription.toLowerCase().match(t)||c[g].label.toLowerCase().match(t))&&(""!=tags&&(tags+=", "),tags+=a)}),m="هيئة الطرق و المواصلات - دليل الخدمات : "+c[g].label.trim(),$(".search-result").prepend('<li class="more-visible" data-show="1" data-tag="'+tags+'"><span><a href="https://www.rta.ae/wps/portal/rta/ae/home/idos?serviceId='+c[g].value.trim()+'" class="tlink" target="_blank">'+c[g].label.trim()+"</a><br>"+m+'</span><a href="https://www.rta.ae/wps/portal/rta/ae/home/idos?serviceId='+c[g].value.trim()+'" target="_blank">www.rta.ae/wps/portal/rta/ae/home/idos?serviceId='+c[g].value.trim()+"</a></li>"),$count++;$.each(s.items,function(){$item=$(this);var a="";try{null!=$item[0].pagemap.cse_image[0].src&&(a=$item[0].pagemap.cse_image[0].src)}catch(t){}if(""!=a){var s=a.substring(a.lastIndexOf(".")+1);$.inArray(s,o)<0&&(a="")}tags="",$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");($item[0].snippet.toLowerCase().match(t)||$item[0].title.toLowerCase().match(t))&&(""!=tags&&(tags+=", "),tags+=a)}),""!=a&&(a='<a href="'+$item[0].link+'" target="_blank"><img src="'+a+'" width="100" /></a> '),""!=tags&&(tags+=", "),tags+=$item[0].title;for(var r=!0,i=0;i<c.length;i++){var l="https://www.rta.ae/wps/portal/rta/ae/home/idos?serviceId="+c[i].value.trim();if(c[i].label.trim()==$item[0].htmlTitle.trim()||$item[0].link.trim()==l){r=!1;break}}if(1==r)if(e.length<=2){var h=new RegExp(e.toLowerCase(),"gi");$item[0].title.toLowerCase().match(h)&&$(".search-result").append('<li class="more-visible" data-show="1" data-tag="'+tags+'">'+a+'<span><a href="'+$item[0].link+'" class="tlink" target="_blank">'+$item[0].htmlTitle+"</a><br>"+$item[0].htmlSnippet+'</span><a href="'+$item[0].link+'" target="_blank">'+$item[0].formattedUrl+"</a></li>")}else $(".search-result").append('<li class="more-visible" data-show="1" data-tag="'+tags+'">'+a+'<span><a href="'+$item[0].link+'" class="tlink" target="_blank">'+$item[0].htmlTitle+"</a><br>"+$item[0].htmlSnippet+'</span><a href="'+$item[0].link+'" target="_blank">'+$item[0].formattedUrl+"</a></li>")})}}),$("#searchTags").html("<b>"+e+"</b> "+$count+" نتائج"),$(".more-visible").slice(permore).hide(),$count>1?$("#searchTags").html("<b>"+decodeURIComponent(e)+"</b> "+$count+" نتائج"):$("#searchTags").html("<b>"+decodeURIComponent(e)+"</b> "+$count+" نتيجة"),$count>permore&&t.show(),$("#searchResults").show(),$("#searchResultsLoader").hide()}}else $("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").append("<li>لا توجد نتائج</li>"),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$("#searchResultsNone").show(),$("#searchResults").hide(),$("#searchResultsLoader").hide();else $("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").append("<li>لا توجد نتائج</li>"),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$("#searchResultsNone").show(),$("#searchResults").hide(),$("#searchResultsLoader").hide()}})):($("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;")),$(".load-more-search").length>0&&$(".load-more-search").attr("data-load","true")}window.location.href.indexOf("true")>-1&&($("#leftnav_part #show_login").css("display","none"),$("#leftnav_part #loggedin").html('<a id="show_manage_account" href="/wpsv5/wps/myportal/rta/ae/home/my-rta-account"><span>Manage<br>Account</span></a><a id="show_logout" href="/wpsv5/wps/myportal/rta/ae/home/saml/samllogout"><span>Log out</span></a>'));var a=getUrlVars().kw;""!=a&&"undefined"!=typeof a&&($("#searchKW").val(decodeURIComponent(a)),e()),$("#search_part .search-autosuggest ul").empty(),$("#search_part").on("mouseleave",function(){$(".search-autosuggest").hide()}).on("mouseover",function(){$(".search-autosuggest").show()}),"undefined"==typeof permore&&(permore=5),$(".more-visible").slice(permore).hide();var t=$(".load-more-search");$(window).scroll(function(){$(".load-more-search").length>0&&$(window).scrollTop()+$(window).height()>=$(".load-more-search").offset().top+100&&"true"==$(".load-more-search").attr("data-load")&&($(".load-more-search").attr("loaded")||($(".load-more-search").attr("loaded",!0),t.trigger("click")))}),t.click(function(){$me=$(this),permore=$me.attr("data-id"),$(".more-visible:hidden").slice(0,permore).fadeToggle(500),0==$(".more-visible:hidden").length&&t.hide(),$(".load-more-search").attr("loaded","")}),$("#searchKW").keypress(function(e){if(13==e.which){if($("#show_manage_account").length>0){var a=!0;"ar"==$.cookie("locale_new")?location.href="/wpsv5/links/Design/asearch.html?kw="+encodeURI($(this).val())+"&"+a:location.href="/wpsv5/links/Design/esearch.html?kw="+encodeURI($(this).val())+"&"+a}else{var a=!1;"ar"==$.cookie("locale_new")?location.href="/wpsv5/links/Design/asearch.html?kw="+encodeURI($(this).val())+"&"+a:location.href="/wpsv5/links/Design/esearch.html?kw="+encodeURI($(this).val())+"&"+a}e.preventDefault()}}),$(".sugclose").click(function(){$("#search_part .search-autosuggest").hide(),$(this).hide()});var s,r=500,o=["png","jpg","gif","jpeg"];$("#searchKW, #searchServicesKW").bind("focusin",function(){$("#search_part").addClass("active")}),$("#searchKW, #searchServicesKW").bind("focusout",function(){$("#search_part").removeClass("active")}),$("#searchKW").keyup(function(){clearTimeout(s),s=setTimeout(e,r)}),$("#searchKW").keydown(function(){clearTimeout(s)}),$(".suggestions").on("click","a",function(){$me=$(this);$(".load-more-search").attr("data-id");if($(".search-msg").html(""),$me.hasClass("active")){$(".search-result").html();$(".search-result").html(function(e,a){return a.replace(/<b>/g,"").replace(/<\/b>/g,"")}),$me.removeClass("active")}else $me.addClass("active");$kw="",$(".search-result li").hide(),$resultsvis=0,$(".suggestions li a").each(function(e,a){$c=$(this),$c.hasClass("active")&&($(".search-result span").each(function(e,a){$t=$(this);var t=$t.html(),s=new RegExp($c.html(),"gi");$t.html(t.replace(s,"<b>$&</b>"))}),""!=$kw&&($kw+=", "),$kw+=$c.html(),$(".search-result li").each(function(e,a){$t=$(this);var t=new RegExp($c.html(),"gi"),s=$t.attr("data-tag");s.match(t)&&($t.show(),$resultsvis++)})),$(".suggestions-all a").removeClass("active")}),t.hide();var e=$(".search-result > li:visible").length;e>1?$("#searchTags").html("<b>"+$kw+"</b> "+e+" نتائج"):$("#searchTags").html("<b>"+$kw+"</b> "+e+" نتيجة"),0>=e?$(".search-msg").html("نأسف! لا توجد نتائج."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","false"),$(".suggestions li a.active").length<=0&&$(".suggestions-all a").trigger("click")}),$(".suggestions-all a").click(function(){var e=$(".load-more-search").attr("data-id");$me=$(this),$me.addClass("active"),$(".search-result li").show(),$(".suggestions li a").each(function(e,a){$(this).removeClass("active")}),console.log(e),$(".search-result li").slice(e).hide(),t.show(),0==$(".search-result li:hidden").length&&t.hide();var a=$(".search-result > li").length;a>1?$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" نتائج"):$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" نتيجة"),0>=a?$(".search-msg").html("نأسف! لا توجد نتائج."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","true")})});